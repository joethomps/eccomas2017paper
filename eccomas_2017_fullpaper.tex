\documentclass{mbd_fullpaper}
%\documentclass{article}
%\usepackage[a4paper]{geometry}
\usepackage{amsmath,amsfonts,amssymb,amsthm,amsbsy,amsmath}
\usepackage{pgfplots}
\usepackage{subfigure}
\usetikzlibrary{shapes,arrows,scopes,patterns,decorations.pathreplacing}

\begin{document}

%New commands
\newcommand{\heading}[1]{
   {\medskip\hskip5em\bf\large{#1}
   \vskip0.5ex
   }
}
\newcommand{\eqnref}[1]{
  (\ref{#1})
}

\renewcommand{\refname}{\medskip\bf\large References}



%------------------------------------------------------------
% title
\begin{center}
  \Large{\bf
Equivalent Mass-Spring Models of Multibody Spacecraft for the Application of Wave-based Control  }
\end{center}

%------------------------------------------------------------
% authors
\begin{center}
\large{
Joseph W. Thompson
}
\end{center}

%------------------------------------------------------------
% affiliations
{
\begin{center}
 \small
  \begin{tabular}{c}
    School of Mechanical and Materials Engineering \\
    University College Dublin              \\
    Belfield, Dublin 4, Ireland        \\
    joseph.thompson@ucdconnect.ie                        \\
  \end{tabular}
\end{center}
}

%------------------------------------------------------------
% abstract



\section*{Abstract}
% It contains a general introduction to the topic, outlines the major results, and summarizes the conclusions.
% 250 words max.

%Wave-Based Control (WBC) is particularly effective for achieving rest to rest motion of under-actuated, cascaded, lumped flexible systems.
%In this control scheme the actuator simultaneously launches and absorbs wave components travelling into and out of the system at one end.
%By doing this the control scheme combines position control and active vibration damping.
%Much work has been done on wave-based modelling and control of mass-spring strings.
%This paper asks the question: to what extent can this work be extended to a wider class of systems?
%This question is motivated by the control of spacecraft with features such as structural flexibility, flexible appendages and fuel slosh.
%Most mathematical models of these systems presented to the control engineer, do not obviously have the structure of a mass-spring string.
%However, often it is possible to calculate an equivalent mass-spring system.
%This paper identifies a class of systems, with real, positive and distinct eigenvalues, for which this transformation is possible and presents an algorithm for calculating the equivalent mass and spring values.
%A segmented planar multibody rocket model is used as an example.
%This model consists of three rigid bodies connected by two torsional springs and a gimballed rocket engine with constant thrust which may be used for attitude control.
%Several test cases with different sensor and actuator configurations are examined and equivalent mass-spring systems are calculated in each case.

%\keywords{multibody spacecraft, attitude control, mechanical waves, vibration, lumped systems}

\section{Introduction}
% The first paragraph should follow the inverted triangle principle: start with a broad statement and
% become more detailed until finally identifying the specific problem that the paper addresses.
Many spacecraft and rockets may be modelled as multi-body systems \cite{kane}.
Flexible structures such as solar panels, or robot arms, may be approximated by a lumped equivalent - a number of joined rigid bodies, with springs in each joint.
Sloshing fuel may be represented by a simple pendulum or a mass-spring analog.
These simple representations are particularly useful in the design of an attitude controller.
These systems are usually under-actuated i.e. have more degrees of freedom than actuators.
In attempting to re-orient such a system, one will usually excite certain modes of vibration.
To bring the system back to rest, the control algorithm must effectively dampen these vibrations.
To end up with the correct target attitude at the end of a manoeuvre this exciting and damping of vibrations must be done in precisely the right way.
One possible approach to this problem is to model the motion of each part of the system as a superposition of two components or `waves'.
One wave is travelling from the actuator into the system and the other is travelling from the system back towards the actuator.
In this way the actuator is simultaneously launching a wave into the system and absorbing a returning wave from the system.
A complete manoeuvre consists of launching a certain wave into the system and then absorbing the returning wave to bring the system back to rest.
The above wave-based control technique has been applied successfully to uniform and non-uniform rectilinear mass-spring systems.
The aim of this paper is to extend the wave-based control theory to a wider class of systems, namely the multi-body spacecraft described above. 

\begin{figure}[h]
  \begin{center}
    	%\includegraphics[scale=1]{graphics/WBC-nunif-mspring-force.pdf}
    	\input{graphics/WBC-nunif-mspring-force.tex}
	\caption{Wave-based control scheme for a mass-spring string \label{fig:wave-based-control}}
  \end{center}
\end{figure}
Figure \ref{fig:wave-based-control} shows a simple wave-based control system.
The generic mass-spring string shown is a classical example of an under-actuated control problem.
The motion of this lumped system may be modelled as a superposition of two "waves" or wave-like components travelling rightwards and leftwards \cite{OConnor2011}.
Using this wave-based interpretation of the system, linear controllers have been designed with a number of desirable properties \cite{Connor2005}. 
These include robustness to modelling errors, system changes, sensor delays and non-ideal actuation, minimal sensing and ease of implementation.
These controllers operate as follows: The initial movement of the actuator $x_0$ launches a wave (motion which propagates rightwards through the string) which reaches the system boundary and is reflected.
After reflection the motion (returning wave) travels leftwards back to the actuator which moves to absorb it.
This returning wave is resolved using two measurements from the system.
These measurements can be positions, velocities or forces and are usually taken close to the actuator.
In Figure \ref{fig:wave-based-control} these measurements are the position of the first mass $x_1$ and the force being applied to the first mass $f_0$.
In addition to the mass-spring shown in Figure \ref{fig:wave-based-control} this type of controller has been applied to a much wider array of systems. (citations)
However in these cases the approach to controller design and tuning has been experimental in nature and the underlying waves are not clearly defined.
It is proposed here that many of these more complicated systems are in fact similar in structure to the mass-spring system in Figure \ref{fig:wave-based-control}.
Furthermore it is proposed that through a suitable change of coordinates, an equivalent mass-spring string may be calculated for many of these systems.
Given a SISO (single-input single-output) undamped system described by:
\begin{equation}
\ddot{\mathbf{q}}(t) + \Lambda\mathbf{q}(t) = \mathbf{b}u(t)
\label{eq:modal1}
\end{equation}
\begin{equation}
y(t) = \mathbf{c}^T \mathbf{q}(t)
\label{eq:modal2}
\end{equation}
where
\begin{equation}
\Lambda = \begin{bmatrix}
\lambda_1  &  0 & \cdots & 0 \\
0 & \lambda_2  & \ddots & 0 \\
\vdots & \ddots & \ddots & \vdots \\
0 & 0 & \cdots & \lambda_n \end{bmatrix}
,\quad \mathbf{b} = \begin{bmatrix} b_1 \\ b_2 \\ \vdots \\ b_n \end{bmatrix}
,\quad \mathbf{c} = \begin{bmatrix} c_1 \\ c_2 \\ \vdots \\ c_n \end{bmatrix}
\label{eq:modal3}
\end{equation}
where $u(t)$ is the input and $y(t)$ is the output, this leads to the following problem statement:
\begin{enumerate}
\item under what conditions can this system be transformed into an equivalent mass-spring string such as in Fig.1 (for which WBC is known to work well) and
\item how can the parameters of this equivalent system be calculated?
\end{enumerate}
The problem becomes if (and if so, how) we can find a coordinate transformation
\begin{equation}
\mathbf{x} = P \mathbf{q}
\label{eq:transform}
\end{equation}
such that:
\begin{equation}
M\ddot{\mathbf{x}}(t) + K\mathbf{x}(t) = \mathbf{\hat{b}}u(t)
\label{eq:ms1}
\end{equation}
\begin{equation}
y(t) = \mathbf{\hat{c}}^T \mathbf{x}(t)
\label{eq:ms2}
\end{equation}
and $M$, $K$, $\mathbf{\hat{b}}$ and $\mathbf{\hat{c}}$ have the following structure:
\begin{equation}
M = \begin{bmatrix}
m_1  &  0 & \cdots & 0 \\
0 & m_2  & \ddots & 0 \\
\vdots & \ddots & \ddots & \vdots \\
0 & 0 & \cdots & m_n \end{bmatrix}
, \quad
K = \begin{bmatrix}
k_1+k_2  &  -k_2 & 0 & \cdots & 0 \\
-k_2 & k_2+k_3  & -k_3 & \ddots & 0 \\
0 & -k_3 & \ddots & \ddots & \vdots \\
\vdots & \ddots & \ddots & k_{n-1}+k_n & -k_{n} \\
0 & 0 & \cdots & -k_{n} & k_n \end{bmatrix}
,\quad \mathbf{\hat{b}} = \begin{bmatrix} 1 \\ 0 \\ \vdots \\ 0 \end{bmatrix}
,\quad \mathbf{\hat{c}} = \begin{bmatrix} 1 \\ 0 \\ \vdots \\ 0 \end{bmatrix}
\label{eq:ms3}
\end{equation}

%The introduction ends with the “road-map” paragraph. This paragraph outlines the remaining sections of the paper. It can either give a general outline of the contribution,
%or a specific, section-by-section breakdown of the remaining article.
Road map
Section 2 - WBC control system
Section 3 - Mathematical model of segmented rocket
Section 4 - Class of systems to which WBC can be applied, and algorithm for converting to standard mass-spring form
An algorithm is developed to find a suitable coordinate transformation $\mathbf{z} = P \mathbf{q}$ to achieve this objective.
The problem may be first reduced to an inverse eigenvalue problem for a Jacobi matrix. This may be solved using the Lanczos algorithm as presented in \cite{gladwell1986inverse}. 
It is found that there are many equivalent mass-spring systems depending on the desired forms of the input vector $\hat{\mathbf{b}}$ and output matrix $c$, that is, on the input-output structure of the system or the location(s) of actuators and sensors in the string.
Section 5 - Numerical Examples - different position of sensors, actuators
Section 6 - Discussion
Section 7 - Conclusions 

\section{Equivalent Mass-Spring Models}
This section outlines a procedure for converting a generic SISO vibrating system described by equations \ref{eq:modal1}-\ref{eq:modal3} to an in-line mass-spring system described by equations \ref{eq:ms1}-\ref{eq:ms3}.
This conversion amounts to finding the transformation matrix $P$ of equation \ref{eq:transform}.
The coordinate transformation is carried out in three steps.

\subsection{Step 1 - Scaling the States}
First consider the transformation $\mathbf{v} = A \mathbf{q}$ where $A = diag(a_1, a_2, ..., a_n)$ is a diagonal matrix with strictly positive diagonal.
This transformation merely scales the states of the system and leads to the new system:
\begin{equation}
\ddot{\mathbf{v}}(t) +  \Lambda \mathbf{v}(t) =  A^{-1} \mathbf{b}u(t)
\label{eq:scaled1}
\end{equation}
\begin{equation}
y(t) = \mathbf{c}^T  A \mathbf{v}(t)
\label{eq:scaled2}
\end{equation}
Here the input and output vectors $\mathbf{b}$ and $\mathbf{c}$ are changed however the matrix $\Lambda$ of eigenvalues is unaffected by the transformation.
The choice of values $a_i$ is used to ensure that the after the last step the final input and output vectors of the mass-spring system $\mathbf{\hat{b}}$ and $\mathbf{\hat{c}}$ have the correct form.
The required values of the $a_i$ are calculated in section \ref{sec:choiceai} to follow.

\subsection{Step 2 - Inverse Eigenvalue Problem for Jacobi Matrix}
In \cite{gladwell1986inverse} Gladwell investigates inverse eigenvalue problems for Jacobi matrices which are defined as follows:
a Jacobi matrix is a positive semi-definite symmetric tri-diagonal matrix with strictly negative co-diagonal.
We make use of the following theorem: there is a unique Jacobi matrix $\mathbf{J}$ having specified eigenvalues $(\lambda_i)_1^n$, where
\begin{equation}
0 \leq \lambda_1<\lambda_2< \cdots <\lambda_n
\label{eq:lambda}
\end{equation}
and with normalised eigenvectors $(\mathbf{u}_i)_1^n$  having non-zero specified values $(u_{1i})_1^n$ of their first or components.
Recall that $\mathbf{u}_i = \begin{bmatrix} u_{1i} &  u_{2i} & \cdots & u_{ni} \end{bmatrix}^T$.
To simplify notation let $U$ be the matrix whose columns are the eigenvectors $\mathbf{u}_i$ of the Jacobi matrix $J$ and let $X$ be the transpose of this matrix with columns $\mathbf{x}_i$.
Then
\begin{equation}
X=U^T
\end{equation}
and the above theorem says that for a given $\Lambda$ and $\mathbf{x_1}$ (the first column of $X$) there is a unique Jacobi matrix $J$.
The Lanczos algorithm may be used to calculate matrices $J$ and $U$ ($X^T$) for a given $\Lambda$ and $\mathbf{x_1}$ such that 
\begin{equation}
J U = U \Lambda
\end{equation}
(where $J$ is a Jacobi matrix and $U U^T = I$).
Using this algorithm we can find the second transformation $\mathbf{z} = U \mathbf{v}$ which leads to the new system:
\begin{equation}
\ddot{\mathbf{z}}(t) + J \mathbf{z}(t) =   U A^{-1} \mathbf{b}u(t)
\label{eq:jacobi1}
\end{equation}
\begin{equation}
y(t) = \mathbf{c}^T  A U^T \mathbf{z}(t)
\label{eq:jacobi2}
\end{equation}
Note that this transformation is only possible if Equation \ref{eq:lambda} holds.

\subsection{Step 3 - Reconstruction of Mass and Stiffness Matrices}
The final step is to reconstruct the mass and stiffness matrices $M$ and $K$.
It can be shown that $J =  M^{-\frac{1}{2}} K M^{-\frac{1}{2}}$ and the transformation $\mathbf{x} = M^{\frac{1}{2}} \mathbf{z}$ where $M$ has the form given in Equation \ref{eq:ms3} leads to the final system:
\begin{equation}
M \ddot{\mathbf{x}}(t) + K \mathbf{x}(t) = M^{\frac{1}{2}} U A^{-1} \mathbf{b} u(t)
\label{eq:fin1}
\end{equation}
\begin{equation}
y(t) = \mathbf{c}^T  A U^T M^{\frac{1}{2}}\mathbf{x}(t)
\label{eq:fin2}
\end{equation}
By comparing this system to that of equations \ref{eq:ms1}-\ref{eq:ms3} we get the following equation for $\mathbf{b}$ and $\mathbf{c}$.
\begin{equation}
M^{\frac{1}{2}} U A^{-1} \mathbf{b} = M^{\frac{1}{2}} U A \mathbf{c} = \begin{bmatrix} 1 &  0 & \cdots & 0 \end{bmatrix}^T
\label{eq:bhat}
\end{equation}
which can be simplified to
\begin{equation}
A^{-1} \mathbf{b} = A \mathbf{c} = \frac{1}{m_1} U^T \begin{bmatrix} 1 &  0 & \cdots & 0 \end{bmatrix}^T
\label{eq:bc1}
\end{equation}
and then
\begin{equation}
A^{-1} \mathbf{b} = A \mathbf{c} = \frac{1}{m_1} \mathbf{x}_1
\label{eq:bc2}
\end{equation}
This can be solved to give
\begin{equation}
a_i = \sqrt{\frac{b_i}{c_i}} ,\quad m_1 = \sqrt{\frac{1}{\sum b_i c_i}} ,\quad x_{i1} = \sqrt{\frac{b_i c_i}{\sum b_i c_i}}
\label{eq:bcxm}
\end{equation}
By combining the three steps the overall transformation can be written as
\begin{equation}
P =  M^{-\frac{1}{2}} U A^{-1}
\label{eq:p}
\end{equation}
Examining equation \ref{eq:bcxm} we find that a second necessary and sufficient condition for $P$ to exist is
\begin{equation}
\frac{b_i}{c_i} > 0 \quad \forall i
\label{eq:bc}
\end{equation}
Also note that if
\begin{equation}
\frac{b_i}{c_i} < 0 \quad \forall i
\end{equation}
then we can simply consider the input to be $-u(t)$ instead of $u(t)$ so that $\mathbf{b}$ becomes $-\mathbf{b}$ and then equation \ref{eq:bc} will be satisfied.   

\section{Mathematical Model of Segmented Rocket}
In this section the equations of motion for a planar segmented rocket are presented.
It should be noted that even though this is a lumped model with three bodies and two springs, the dynamics of this system are quite different from that of a simple rectilinear 3-mass, 2-spring system and the subtle differences, which will become clear in subsequent sections are what motivate the current study.
Also note that from control point of view it is inputs and outputs to the system that are important.
When the input is a gimballed engine on the bottom segment and teh output is the angle of that segment
When sensor is at top how can we apply WBC theory.
Also uniformity

\begin{figure}[h]
  \begin{center}
    \input{graphics/seg3-rocket-allact.tex}
    %\includegraphics[scale=1]{graphics/seg3-rocket-allact.pdf}
    \caption{Segmented planar rocket model \label{fig:rocket-model}}
  \end{center}
\end{figure}
The model consists of three rigid bodies connected by two torsional springs as shown in figure \ref{fig:rocket-model}.
The attitude of the bottom or base segment is $\theta$ relative to an inertial reference frame.
The middle and top segments have angles $\phi_1$ and $\phi_2$ respectively between themselves and the segment below as shown.
Each segment has has height $h$, mass $m$ and moment of inertia $I$ about its mass centre and each torsional spring has stiffness $k$.
The rocket is considered to have four possible sources of actuation: a lateral forces $f_i$ at the top of each segment and an engine that may be gimballed by angle $\delta$ on the bottom segment as shown.
This combination of inputs allow many different cases to be considered.
Similarly the rocket has three outputs or attitude sensors, one on each segment which we will call $\alpha_1$, $\alpha_2$ and $\alpha_3$ respectively
The rotational equations of motion of the system were derived using Kane's method \cite{Kane1980} and linearised about the equilibrium point $\theta=\dot{\theta}=\phi_i=\dot{\phi}_i=0$
\begin{multline}
\input{python/eq1.tex}
\end{multline}
\begin{equation}
\input{python/eq2.tex}
\end{equation}

\section{Examples}

Physical parameters vega
\renewcommand{\arraystretch}{1.5}
\begin{table}[!ht]
  \begin{center}
    \caption{Summary of model parameters representative of \emph{Vega} rocket \label{tab:modelparam}}
    \vspace{1mm}
    \begin{tabular}{ ccc }
	\hline
           Parameter & Value & Unit \\
	\hline
      	$m$ & $5 \cdot 10^4$ & $kg$\\
      	$k$ & $6 \cdot 10^7$ & $Nm$\\
      	$I$ & $5 \cdot 10^5$ & $kg~m^2$\\
      	$h$ & $10$ & $m$\\
      	$T$ & $2.3 \cdot 10^6$ & $N$\\
    \end{tabular}
    \label{tab:tab1}
  \end{center}
\end{table}
%\begin{multline}
%\input{python/eqnum.tex}
%\end{multline}
\begin{multline}
\input{python/eqdiag1.tex}
\end{multline}
\begin{equation}
\input{python/eqdiag2.tex}
\end{equation}
%\begin{equation}
%\input{python/eqtrans.tex}
%\end{equation}

\begin{figure}[h]
  \begin{center}
    \input{graphics/rocket-trans.tex}
    \caption{Segmented planar rocket model \label{fig:rocket-model}}
  \end{center}
\end{figure}

\renewcommand{\arraystretch}{1.5}
\begin{table}[!ht]
  \begin{center}
    \caption{Summary of model parameters representative of \emph{Vega} rocket \label{tab:modelparam}}
    \vspace{1mm}
    \begin{tabular}{ ccccccc }
	\hline
           Input & Output & $m_1$ & $m_2$ & $m_3$ & $k_1$ & $k_2$ \\
	\hline
      	$\delta$ & $\alpha_1$ & 0.056 & 0.069 & 0.242 & 7.89 & 6.07  \\
      	$f_2$ & $\alpha_2$ & $0.243\cdot 10^6$ & $2.11\cdot 10^6$ & $0.0965\cdot 10^6$ & $6.71\cdot 10^7$ & $0.568\cdot 10^7$ \\
      	$f_3$ & $\alpha_3$ & $1.29\cdot 10^5$ & $1.55\cdot 10^5$ & $4.38\cdot 10^5$ & $1.83\cdot 10^7$ & $1.25\cdot 10^7$ \\
    \end{tabular}
    \label{tab:tab1}
  \end{center}
\end{table}

Note: ignoring aerodynamics and gravity, for demonstration purposes only!
Several models defined by different sensor actuator configs
Conversion to equivalent mass-spring model
Numerical version of equations above
Signs
Compatible actuators and sensors

The details of the wave-based control scheme
linear controller
State space system
tuning parameters w and k0
choose w from k1 m1
Example step responses

\begin{figure}[h]
  \begin{center}
    \subfigure{\input{graphics/graphdel.tex} \label{fig:graphdel}}   
    \subfigure{\input{graphics/graphf2.tex} \label{fig:graphf2}}
	\subfigure{\input{graphics/graphf3.tex} \label{fig:graphf3}}
    \caption{Step responses for a simple wave-based control system for each choice of actuator and sensor \label{fig:graphs}}
  \end{center}
\end{figure}

\section{Discussion}
Is conversion possible, when is possible
Still a \ref{fig:graphdel} large class of systems

Mass Spring ratios, uniformity better
for that rocket model sensor at bottom is better
Wave-based intuition behind this. Longer settling time for actuator at top
System tells us best location for actuator
Future work, use this to optimise actuator and sensor location

\section{Conclusions}


%------------------------------------------------------------
% biliography
\bibliographystyle{acm}
\bibliography{eccomas_2017}

\end{document} 
